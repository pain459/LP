<!DOCTYPE html>
<html>
<head>
    <title>Fake Profile Generator</title>
</head>
<body>
    <h1>Fake Profile Generator</h1>
    <form id="profileForm">
        <label for="numRecords">Number of Records:</label>
        <input type="number" id="numRecords" name="numRecords" min="1" value="10">
        <input type="submit" value="Generate">
    </form>
    <a href="#" id="downloadLink" style="display: none;" download="fake_profiles.csv">Download CSV</a>
    <script>
        document.getElementById('profileForm').addEventListener('submit', function(e) {
            e.preventDefault();
            const numRecords = document.getElementById('numRecords').value;
            fetch(`http://localhost:8080/api/generate_profiles/?num_records=${numRecords}`)
                .then(response => response.json())
                .then(data => {
                    const csvContent = convertToCSV(data);
                    const blob = new Blob([csvContent], { type: 'text/csv;charset=utf-8;' });
                    const downloadLink = document.getElementById('downloadLink');
                    downloadLink.href = URL.createObjectURL(blob);
                    downloadLink.style.display = 'block';
                })
                .catch(error => console.error('Error:', error));
        });

        function convertToCSV(data) {
            const headers = Object.keys(data[0]);
            const csvRows = [];
            csvRows.push(headers.join(','));

            for (const record of data) {
                const values = headers.map(header => record[header]);
                csvRows.push(values.join(','));
            }

            return csvRows.join('\n');
        }
    </script>
</body>
</html>
